# 解析几何数据集状态空间分析

基于对解析几何数据集的深入分析，我们提出建立一个**双层耦合状态空间 (Bilayer Coupled State Space)** 模型。该模型旨在精准捕捉解析几何题目中“几何直观引导”与“代数计算求证”的双重特征。

## 1. 核心理念

解析几何的本质是用代数方法解决几何问题。解题过程不仅是单纯的代数运算，更依赖于几何图形提供的结构信息来指导运算方向。因此，状态空间不应是扁平的，而应包含两个紧密耦合的层级：

*   **几何语义层 (Geometric Semantic Layer, $G$)**：对应题目中的 `fact_expressions`，负责策略规划。
*   **代数约束层 (Algebraic Constraint Layer, $A$)**：对应题目中的 `process`，负责具体执行。

## 2. 状态空间定义 $S = (G, A)$

单一时刻的状态可以表示为一个二元组 $S_t = (G_t, A_t)$。

### 2.1 几何语义层 ($G$)
这一层是一个**异构图 (Heterogeneous Graph)**，用于模拟人类对图形结构的认知。

*   **节点 (Nodes)**：
    *   **几何实体**：Point ($P$), Line ($l$), Circle ($O$), Conic ($C$), Triangle ($T$) 等。
    *   **值与参数**：Scalar ($k, m, \lambda$), Value ($1, \sqrt{2}, \pi$)。
*   **边 (Edges/Hyperedges)**：
    *   **拓扑关系**：`On(P, l)`（点在直线上）, `Tangent(l, C)`（相切）, `Parallel(l_1, l_2)`（平行）。
    *   **依附关系**：`Focus(C, F)`（焦点）, `Center(O, P)`（圆心）, `Slope(l, k)`（斜率）。

> **功能**：作为**策略网络 (Policy Network)** 的输入。通过图上的模式匹配（如发现“直线与圆相切”），检索潜在可用的引理（Lemma）。

### 2.2 代数约束层 ($A$)
这一层是一个**方程系统 (System of Equations)**，用于符号求解。

*   **变量集 (Variables)**：几何事实参数化后的标量集合。例如，点 $P$ 映射为 $\{x_P, y_P\}$，直线 $l$ 映射为 $\{A, B, C\}$ 或 $\{k, b\}$。
*   **约束集 (Constraints)**：
    *   **等式约束**：$f(x_1, \dots, x_n) = 0$。例如由圆方程 $(x-a)^2 + (y-b)^2 = r^2$ 实例化而来的方程。
    *   **不等式约束**：$g(x_1, \dots, x_n) > 0$。例如判别式 $\Delta > 0$，参数范围 $a > 0$。

> **功能**：作为**推理引擎 (Reasoning Engine)** 的工作区。利用符号计算库（如 SymPy）进行方程组的化简、代入和求解。

## 3. 状态转移机制 (State Transition)

解题过程实质上是状态空间的信息流动与扩张。每一步 Action 可以定义为一个算子 $T: S_t \to S_{t+1}$，主要包含以下两种模式：

### 3.1 几何向代数转换 (Translation: $G \to A$)
这是解题中最关键的一步，即“列方程”。

*   **触发条件**：在几何层 $G_t$ 中匹配到特定的子图结构。
*   **转换规则**：应用几何引理。
*   **示例**：
    *   **匹配**：在 $G_t$ 中发现 `Line(l)`, `Circle(O)`, `Tangent(l, O)`。
    *   **引理**：圆心到直线的距离等于半径。
    *   **更新**：向 $A_t$ 中添加方程 $d(Center(O), l) = Radius(O)$。

### 3.2 代数向几何反向传播 (Back-propagation: $A \to G$)
这是计算结果反馈到几何认知的过程。

*   **触发条件**：
    *   $A_t$ 中某个变量解出了唯一值（如 $k=1$）。
    *   $A_t$ 中发现了关键的代数特征（如 $\Delta = 0$）。
*   **更新规则**：
    *   **实例化**：将 $G_t$ 中的参数节点更新为具体数值。
    *   **性质推导**：若 $\Delta=0$，则在 $G_t$ 中添加 `Tangent` 边。

## 4. 方案优势

1.  **可解释性强**：完美对应了数据集中 `text` -> `fact_expressions` ($G$) -> `process` ($G \leftrightarrow A$) 的结构。
2.  **计算高效**：相比于暴力的全代数联立，几何层的引导作用可以过滤掉绝大多数无效的代数运算，只有在几何上有意义时才建立方程。
3.  **支持多步推理**：这种双层结构天然支持多跳推理（Multi-hop Reasoning），即 $G \to A \to G' \to A'$ 的迭代过程。
